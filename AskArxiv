import getpass
import os



import openai
from langchain_community.llms import OpenAI

from langchain_core.output_parsers import StrOutputParser
from langchain_core.prompts import ChatPromptTemplate
from langchain_core.runnables import RunnablePassthrough
from langchain_community.retrievers import ArxivRetriever
API_SECRET_KEY = 'sk-gKrFRQIZQWfNyAy949C7B08180C2453086Cc61C8355fB64f'
BASE_URL = 'https://api.bianxie.ai/v1'
os.environ["OPENAI_API_KEY"] = API_SECRET_KEY
os.environ["OPENAI_API_BASE"] = BASE_URL
llm = OpenAI(temperature=0.9)

prompt = ChatPromptTemplate.from_template(
    """Answer the question based only on the context provided.

Context: {context}

Question: {question}"""
)
retriever = ArxivRetriever(
    load_max_docs=2,
    get_ful_documents=True,
)

def format_docs(docs):
    return "\n\n".join(doc.page_content for doc in docs)


chain = (
    {"context": retriever | format_docs, "question": RunnablePassthrough()}
    | prompt
    | llm
    | StrOutputParser()
)
print(chain.invoke("What is the ImageBind model?"))